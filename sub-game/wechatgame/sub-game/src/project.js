require=function i(r,s,c){function l(e,t){if(!s[e]){if(!r[e]){var a="function"==typeof require&&require;if(!t&&a)return a(e,!0);if(u)return u(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var o=s[e]={exports:{}};r[e][0].call(o.exports,function(t){return l(r[e][1][t]||t)},o,o.exports,i,r,s,c)}return s[e].exports}for(var u="function"==typeof require&&require,t=0;t<c.length;t++)l(c[t]);return l}({rankItem:[function(t,e,a){"use strict";cc._RF.push(e,"2ea122nO/RHh6TtBebeJW5W","rankItem"),cc.Class({extends:cc.Component,properties:{rankLabel:cc.Label,avatarImgSprite:cc.Sprite,avatarGroup:cc.Node,nickLabel:cc.Label,topScoreLabel:cc.Label,graphicsNode:cc.Graphics},onLoad:function(){},start:function(){},init:function(t,e){var a=e.avatarUrl,n=e.nickname.length<=10?e.nickname:e.nickname.substr(0,10)+"...",o=0!=e.KVDataList.length?e.KVDataList[0].value:0,i=void 0;if("topRank"==this.node.name){var r=this.graphicsNode;if(null!=r){var s=1;0==t&&(i=cc.hexToColor("#F3E800"),s=1.2),1==t&&(i=cc.hexToColor("#F68500"),s=1.05),2==t&&(i=cc.hexToColor("#A263E6")),r.fillColor=i,r.circle(0,0,13),r.fill(),r.close(),this.avatarGroup.scale=s}}this.rankLabel.string=(t+1).toString(),this.createImage(a),this.nickLabel.string=n,this.topScoreLabel.string=o.toString()},createImage:function(t){var a=this;if(null!=window.wx){if(""==t)return void(this.avatarImgSprite.node.active=!1);try{var e=wx.createImage();e.onload=function(){try{var t=new cc.Texture2D;t.initWithElement(e),t.handleLoadedTexture(),a.avatarImgSprite.spriteFrame=new cc.SpriteFrame(t)}catch(t){cc.log(t),a.avatarImgSprite.node.active=!1}},e.src=t}catch(t){cc.log(t),this.avatarImgSprite.node.active=!1}}else cc.loader.load({url:t,type:"jpg"},function(t,e){a.avatarImgSprite.spriteFrame=new cc.SpriteFrame(e)})}}),cc._RF.pop()},{}],rankingList:[function(t,e,a){"use strict";cc._RF.push(e,"327d8DwnzNBobBdPMT2mrSg","rankingList"),cc.Class({extends:cc.Component,properties:{rankItemPrefab:cc.Prefab,topItemPrefab:cc.Prefab,content:cc.Node,rankListLayout:cc.Node,topContent:cc.Node},onLoad:function(){this.rankData=[],this.displayCnt=6},start:function(){var e=this;this.removeChild();var a="k_cloud_data";null!=window.wx?window.wx.onMessage(function(t){cc.log("Message：",t),0==t.messageType?e.removeChild():"rankList"==t.messageType?(e.rankListLayout.active=!0,e.fetchFriendData(a,"list")):"sendScore"==t.messageType?(console.log("registerScore:"+t.score),e.submitScore(a,t.score)):"groupList"==t.messageType&&(e.rankListLayout.active=!0,console.log("group-rank"),e.fetchGroupData(a,t.shareTicket))}):this.testData(),this.displayRank(this.rankData,6)},submitScore:function(e,a){null!=window.wx?window.wx.getUserCloudStorage({keyList:[e],success:function(t){console.log("getUserCloudStorage","success",t),0!=t.KVDataList.length&&t.KVDataList[0].value>a||window.wx.setUserCloudStorage({KVDataList:[{key:e,value:""+a}],success:function(t){console.log("setUserCloudStorage","success",t)},fail:function(t){console.log("setUserCloudStorage","fail")},complete:function(t){console.log("setUserCloudStorage","ok")}})},fail:function(t){console.log("getUserCloudStorage","fail")},complete:function(t){console.log("getUserCloudStorage","ok")}}):cc.log("error:"+e+" : "+a)},removeChild:function(){this.content.removeAllChildren(),this.topContent.removeAllChildren()},fetchFriendData:function(e,t){var a=this;this.removeChild(),null!=window.wx&&wx.getUserInfo({openIdList:["selfOpenId"],success:function(t){console.log("success",t.data);t.data[0];wx.getFriendCloudStorage({keyList:[e],success:function(t){console.log("wx.getFriendCloudStorage success",t);var e=t.data;e.sort(function(t,e){return 0==t.KVDataList.length&&0==e.KVDataList.length?0:0==t.KVDataList.length?1:0==e.KVDataList.length?-1:e.KVDataList[0].value-t.KVDataList[0].value}),a.rankData=e,a.displayRank(a.rankData,a.displayCnt)},fail:function(t){console.log("wx.getFriendCloudStorage fail",t)}})},fail:function(t){a.loadingLabel.getComponent(cc.Label).string="Test。"}})},fetchGroupData:function(e,a){var n=this;this.removeChild(),null!=window.wx&&wx.getUserInfo({openIdList:["selfOpenId"],success:function(t){console.log("success",t.data);t.data[0];wx.getGroupCloudStorage({shareTicket:a,keyList:[e],success:function(t){console.log("wx.getGroupCloudStorage success",t);var e=t.data;e.sort(function(t,e){return 0==t.KVDataList.length&&0==e.KVDataList.length?0:0==t.KVDataList.length?1:0==e.KVDataList.length?-1:e.KVDataList[0].value-t.KVDataList[0].value}),n.rankData=e,n.displayRank(n.rankData,n.displayCnt)},fail:function(t){console.log("wx.getFriendCloudStorage fail",t)}})},fail:function(t){n.loadingLabel.getComponent(cc.Label).string="Test。"}})},displayRank:function(t,e){this.removeChild();var a=0,n=3,o=9;t.length<3&&(n=t.length),o=t.length>o?o:t.length;for(var i=0;i<n;i++){var r=t[i],s=cc.instantiate(this.topItemPrefab);this.topContent.addChild(s),s.getComponent("rankItem").init(i,r),1==i?s.x=-200:2==i&&(s.x=200)}for(var c=n;c<o;c++){r=t[c],s=cc.instantiate(this.rankItemPrefab);this.content.addChild(s),s.getComponent("rankItem").init(c,r,!0),s.setPositionY(100*-a-50),a++}},testData:function(){for(var t=[],e=0;e<5;e++){var a={avatarUrl:"/resources/close_red.png"};a.KVDataList=[{value:e}],a.nickname="AAAAAA",t.push(a)}this.rankData=t},testFun:function(){}}),cc._RF.pop()},{}]},{},["rankItem","rankingList"]);